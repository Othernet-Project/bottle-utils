<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>bottle_utils.html &mdash; Bottle Utils 0.1a1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.1a1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Bottle Utils 0.1a1 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">Bottle Utils 0.1a1 documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for bottle_utils.html</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">.. module:: bottle_utils.html</span>
<span class="sd">   :synopsis: Functions for use in HTML templates</span>

<span class="sd">.. moduleauthor:: Outernet Inc &lt;hello@outernet.is&gt;</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">unicode_literals</span>

<span class="kn">import</span> <span class="nn">types</span>
<span class="kn">import</span> <span class="nn">functools</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">quote</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">quote</span>


<span class="kn">from</span> <span class="nn">decimal</span> <span class="kn">import</span> <span class="n">Decimal</span>
<span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">request</span><span class="p">,</span> <span class="n">html_escape</span>
<span class="kn">from</span> <span class="nn">dateutil.parser</span> <span class="kn">import</span> <span class="n">parse</span>

<span class="kn">from</span> <span class="nn">.common</span> <span class="kn">import</span> <span class="o">*</span>


<span class="n">SIZES</span> <span class="o">=</span> <span class="s">&#39;KMGTP&#39;</span>
<span class="n">FERR_CLS</span> <span class="o">=</span> <span class="s">&#39;form-errors&#39;</span>
<span class="n">FERR_ONE_CLS</span> <span class="o">=</span> <span class="s">&#39;form-error&#39;</span>
<span class="n">ERR_CLS</span> <span class="o">=</span> <span class="s">&#39;field-error&#39;</span>


<span class="c"># DATA FORMATTING</span>


<div class="viewcode-block" id="plur"><a class="viewcode-back" href="../../html.html#bottle_utils.html.plur">[docs]</a><span class="k">def</span> <span class="nf">plur</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">plural</span><span class="o">=</span><span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="n">n</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">,</span>
         <span class="n">convert</span><span class="o">=</span><span class="k">lambda</span> <span class="n">w</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="n">w</span> <span class="o">+</span> <span class="s">&#39;s&#39;</span> <span class="k">if</span> <span class="n">p</span> <span class="k">else</span> <span class="n">w</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Pluralize word based on number of items. This function provides rudimentary</span>
<span class="sd">    pluralization support. It is quite flexible, but not a replacement for</span>
<span class="sd">    functions like ``ngettext``.</span>

<span class="sd">    This function takes two optional arguments, ``plural()`` and ``convert()``,</span>
<span class="sd">    which can be customized to change the way plural form is derived from the</span>
<span class="sd">    original string. The default implementation is a naive version of English</span>
<span class="sd">    language plural, which uses plural form if number is not 1, and derives the</span>
<span class="sd">    plural form by simply adding &#39;s&#39; to the word. While this works in most</span>
<span class="sd">    cases, it doesn&#39;t always work even for English.</span>

<span class="sd">    The ``plural(n)`` function takes the value of the ``n`` argument and its</span>
<span class="sd">    return value is fed into the ``convert()`` function. The latter takes the</span>
<span class="sd">    source word as first argument, and return value of ``plural()`` call as</span>
<span class="sd">    second argument, and returns a string representing the pluralized word.</span>
<span class="sd">    Return value of the ``convert(w, p)`` call is returned from this function.</span>

<span class="sd">    Here are some simple examples::</span>

<span class="sd">        &gt;&gt;&gt; plur(&#39;book&#39;, 1)</span>
<span class="sd">        &#39;book&#39;</span>
<span class="sd">        &gt;&gt;&gt; plur(&#39;book&#39;, 2)</span>
<span class="sd">        &#39;books&#39;</span>

<span class="sd">        # But it&#39;s a bit naive</span>
<span class="sd">        &gt;&gt;&gt; plur(&#39;box&#39;, 2)</span>
<span class="sd">        &#39;boxs&#39;</span>

<span class="sd">    The latter can be fixed like this::</span>

<span class="sd">        &gt;&gt;&gt; exceptions = [&#39;box&#39;]</span>
<span class="sd">        &gt;&gt;&gt; def pluralize(word, is_plural):</span>
<span class="sd">        ...    if not is_plural:</span>
<span class="sd">        ...        return word</span>
<span class="sd">        ...    if word in exceptions:</span>
<span class="sd">        ...        return word + &#39;es&#39;</span>
<span class="sd">        ...    return word + &#39;s&#39;</span>
<span class="sd">        &gt;&gt;&gt; plur(&#39;book&#39;, 2)</span>
<span class="sd">        &#39;books&#39;</span>
<span class="sd">        &gt;&gt;&gt; plur(&#39;box&#39;, 2, convert=pluralize)</span>
<span class="sd">        &#39;boxes&#39;</span>

<span class="sd">    :param word:    string to pluralize</span>
<span class="sd">    :param n:       number of items from which to calculate plurals</span>
<span class="sd">    :param plural:  function that returns true if the plural form should be</span>
<span class="sd">                    used</span>
<span class="sd">    :param convert: function that converts the string to plural</span>
<span class="sd">    :returns:       word in appropriate form</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">convert</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">plural</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="hsize"><a class="viewcode-back" href="../../html.html#bottle_utils.html.hsize">[docs]</a><span class="k">def</span> <span class="nf">hsize</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">&#39;B&#39;</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1024</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given size in unit produce size with human-friendly units. This is a simple</span>
<span class="sd">    formatting function that takes a value, a unit in which the value is</span>
<span class="sd">    expressed, and the size of multiple (kilo, mega, giga, etc).</span>

<span class="sd">    This function rounds values to 2 decimal places and does not handle</span>
<span class="sd">    fractions. It also uses metric prefixes (K, M, G, etc) and only goes up to</span>
<span class="sd">    Peta (P, quadrillion) prefix.</span>

<span class="sd">    The size multiple (``step`` parameter) is 1024 by default, suitable for</span>
<span class="sd">    expressing values related to size of data on disk.</span>

<span class="sd">    Example::</span>

<span class="sd">        &gt;&gt;&gt; hsize(12)</span>
<span class="sd">        &#39;12.00 B&#39;</span>
<span class="sd">        &gt;&gt;&gt; hsize(1030)</span>
<span class="sd">        &#39;1.01 KB&#39;</span>
<span class="sd">        &gt;&gt;&gt; hsize(1536)</span>
<span class="sd">        &#39;1.50 KB&#39;</span>
<span class="sd">        &gt;&gt;&gt; hsize(2097152)</span>
<span class="sd">        &#39;2.00 MB&#39;</span>

<span class="sd">    :param size:    size in base units</span>
<span class="sd">    :param unit:    base unit without prefix</span>
<span class="sd">    :param step:    size of the multiple</span>
<span class="sd">    :returns:       appropriate units</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
    <span class="n">order</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">while</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="n">step</span><span class="p">:</span>
        <span class="n">size</span> <span class="o">/=</span> <span class="n">step</span>
        <span class="n">order</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">order</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%.2f</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">unit</span><span class="p">)</span>
    <span class="k">return</span> <span class="s">&#39;</span><span class="si">%.2f</span><span class="s"> </span><span class="si">%s%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">SIZES</span><span class="p">[</span><span class="n">order</span><span class="p">],</span> <span class="n">unit</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="trunc"><a class="viewcode-back" href="../../html.html#bottle_utils.html.trunc">[docs]</a><span class="k">def</span> <span class="nf">trunc</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">chars</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Trucante string at ``n`` characters. This function hard-trucates a string</span>
<span class="sd">    at specified number of characters and appends an elipsis to the end.</span>

<span class="sd">    The truncating does not take into account words or markup. Elipsis is not</span>
<span class="sd">    appended if the string is shorter than the specified number of characters.</span>
<span class="sd">    ::</span>

<span class="sd">        &gt;&gt;&gt; trunc(&#39;foobarbaz&#39;, 6)</span>
<span class="sd">        &#39;foobar...&#39;</span>

<span class="sd">    .. note::</span>

<span class="sd">       Keep in mind that the trucated string is always 3 characters longer than</span>
<span class="sd">       ``n`` because of the appended elipsis.</span>

<span class="sd">    :param s:       input string</span>
<span class="sd">    :param chars:   number of characters</span>
<span class="sd">    :returns:       truncated string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">chars</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">s</span>
    <span class="k">return</span> <span class="n">s</span><span class="p">[:</span><span class="n">chars</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;...&#39;</span>

</div>
<div class="viewcode-block" id="yesno"><a class="viewcode-back" href="../../html.html#bottle_utils.html.yesno">[docs]</a><span class="k">def</span> <span class="nf">yesno</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">yes</span><span class="o">=</span><span class="s">&#39;yes&#39;</span><span class="p">,</span> <span class="n">no</span><span class="o">=</span><span class="s">&#39;no&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return ``yes`` or ``no`` depending on value. This function takes the value</span>
<span class="sd">    and returns either yes or no depending on whether the value evaluates to</span>
<span class="sd">    ``True``.</span>

<span class="sd">    Examples::</span>

<span class="sd">        &gt;&gt;&gt; yesno(True)</span>
<span class="sd">        &#39;yes&#39;</span>
<span class="sd">        &gt;&gt;&gt; yesno(False)</span>
<span class="sd">        &#39;no&#39;</span>
<span class="sd">        &gt;&gt;&gt; yesno(True, &#39;available&#39;, &#39;not available&#39;)</span>
<span class="sd">        &#39;available&#39;</span>

<span class="sd">    :param val:     value to test</span>
<span class="sd">    :param yes:     string representation of &#39;yes&#39;</span>
<span class="sd">    :param no:      string representation of &#39;no&#39;</span>
<span class="sd">    :returns:       yes string or no string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">yes</span> <span class="k">if</span> <span class="n">val</span> <span class="k">else</span> <span class="n">no</span>

</div>
<div class="viewcode-block" id="strft"><a class="viewcode-back" href="../../html.html#bottle_utils.html.strft">[docs]</a><span class="k">def</span> <span class="nf">strft</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">fmt</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reformat string datestamp/timestamp. This function parses a string</span>
<span class="sd">    representation of a date and/or time and reformats it using specified</span>
<span class="sd">    format.</span>

<span class="sd">    The format is standard strftime format used in Python&#39;s</span>
<span class="sd">    ``datetime.datetime.strftime()`` call.</span>

<span class="sd">    Actual parsing of the input is delegated to</span>
<span class="sd">    `python-dateutil &lt;https://pypi.python.org/pypi/python-dateutil&gt;`_ library.</span>

<span class="sd">    :param ts:  input datestamp/timestamp</span>
<span class="sd">    :param fmt: output format</span>
<span class="sd">    :returns:   reformatted datestamp/timestamp</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">parse</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span>


<span class="c"># HTML</span>

</div>
<span class="k">def</span> <span class="nf">attr</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Render HTML attribute. This function is used as part of</span>
<span class="sd">    :py:func:`~bottle_utils.html.tag` function to render HTML attributes, but</span>
<span class="sd">    can be used on its own as well. It converts the value into Unicode string</span>
<span class="sd">    and sanitizes it before returning the markup.</span>

<span class="sd">    Basic usage may look like this::</span>

<span class="sd">        &gt;&gt;&gt; attr(&#39;src&#39;: &#39;/images?src=foo.png&amp;w=12&#39;)</span>
<span class="sd">        &#39;src=&quot;/images?src=foo.png&amp;amp;w=12&quot;&#39;</span>

<span class="sd">    All attribute values are double-quoted and any double quotes found inside</span>
<span class="sd">    the value are escaped. User-supplied values can be used reasonably safely.</span>

<span class="sd">    If the value is ``None``, only the attribute name is rendered, otherwise a</span>
<span class="sd">    normal &#39;attribute=&quot;value&quot;&#39; pair is returned::</span>

<span class="sd">        &gt;&gt;&gt; attr(&#39;src&#39;, None)</span>
<span class="sd">        &#39;src&#39;</span>
<span class="sd">        &gt;&gt;&gt; attr(&#39;src&#39;, &#39;&#39;)</span>
<span class="sd">        &#39;src=&quot;&quot;&#39;</span>

<span class="sd">    Therefore, to suppress attribute values completely (i.e., not even have the</span>
<span class="sd">    ``=&quot;&quot;`` part, use ``None`` as the value.</span>

<span class="sd">    :param name:    attribute name</span>
<span class="sd">    :param value:   optional attribute value</span>
<span class="sd">    :returns:       correctly rendered attribute-value pair or attribute name</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">to_unicode</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">attr_escape</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">=&quot;</span><span class="si">%s</span><span class="s">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">name</span>


<div class="viewcode-block" id="tag"><a class="viewcode-back" href="../../html.html#bottle_utils.html.tag">[docs]</a><span class="k">def</span> <span class="nf">tag</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">nonclosing</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wraps content in a HTML tag with optional attributes. This function</span>
<span class="sd">    provides a Pythonic interface for writing HTML tags with a few bells and</span>
<span class="sd">    whistles.</span>

<span class="sd">    The basic usage looks like this::</span>

<span class="sd">        &gt;&gt;&gt; tag(&#39;p&#39;, &#39;content&#39;, _class=&quot;note&quot;, _id=&quot;note1&quot;)</span>
<span class="sd">        &#39;&lt;p class=&quot;note&quot; id=&quot;note1&quot;&gt;content&lt;/p&gt;&#39;</span>

<span class="sd">    Any attribute names with any number of leading underscores (e.g., &#39;_class&#39;)</span>
<span class="sd">    will have the underscores strpped away.</span>

<span class="sd">    If content is an iterable, the tag will be generated once per each member.</span>

<span class="sd">        &gt;&gt;&gt; tag(&#39;span&#39;, [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;])</span>
<span class="sd">        &#39;&lt;span&gt;a&lt;/span&gt;&lt;span&gt;b&lt;/span&gt;&lt;span&gt;c&lt;/span&gt;&#39;</span>

<span class="sd">    It does not sanitize the tag names, though, so it is possible to specify</span>
<span class="sd">    invalid tag names::</span>

<span class="sd">        &gt;&gt;&gt; tag(&#39;not valid&#39;)</span>
<span class="sd">        &#39;&lt;not valid&gt;&lt;/not valid&gt;</span>

<span class="sd">    Please ensure that ``name`` argument does not come from user-specified</span>
<span class="sd">    data, or, if it does, that it is properly sanitized (best way is to use a</span>
<span class="sd">    whitelist of allowed names).</span>

<span class="sd">    Because attributes are specified using keyword arguments, which are then</span>
<span class="sd">    treated as a dictionary, there is no guarantee of attribute order. If</span>
<span class="sd">    attribute order is important, don&#39;t use this function.</span>

<span class="sd">    This module contains a few partially applied aliases for this function.</span>
<span class="sd">    These mostly have hard-wired first argument (tag name), and are all</span>
<span class="sd">    uppercase:</span>

<span class="sd">    - ``A`` - alias for ``&lt;a&gt;`` tag</span>
<span class="sd">    - ``BUTTON`` - alias for ``&lt;button&gt;`` tag</span>
<span class="sd">    - ``HIDDEN`` - alias for ``&lt;input&gt;`` tag with ``type=&quot;hidden&quot;`` attribute</span>
<span class="sd">    - ``INPUT`` - alias for ``&lt;input&gt;`` tag with ``nonclosing`` set to ``True``</span>
<span class="sd">    - ``LI`` - alias for ``&lt;li&gt;`` tag</span>
<span class="sd">    - ``OPTION`` - alias for ``&lt;option&gt;`` tag</span>
<span class="sd">    - ``P`` - alias for ``&lt;p&gt;`` tag</span>
<span class="sd">    - ``SELECT`` - alias for ``&lt;select&gt;`` tag</span>
<span class="sd">    - ``SPAN`` - alias for ``&lt;span&gt;`` tag</span>
<span class="sd">    - ``SUBMIT`` - alias for ``&lt;button&gt;`` tag with ``type=&quot;submit&quot;`` attribute</span>
<span class="sd">    - ``TEXTAREA`` - alias for ``&lt;textarea&gt;`` tag</span>
<span class="sd">    - ``UL`` - alias for ``&lt;ul&gt;`` tag</span>

<span class="sd">    :param name:    tag name</span>
<span class="sd">    :param content: tag content</span>
<span class="sd">    :param attrs:   optional tag attributes</span>
<span class="sd">    :returns:       HTML of the tag with its content and attributes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">open_tag</span> <span class="o">=</span> <span class="s">&#39;&lt;</span><span class="si">%s</span><span class="s">&gt;&#39;</span> <span class="o">%</span> <span class="n">name</span>
    <span class="n">close_tag</span> <span class="o">=</span> <span class="s">&#39;&lt;/</span><span class="si">%s</span><span class="s">&gt;&#39;</span> <span class="o">%</span> <span class="n">name</span>
    <span class="n">attrs</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">attr</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">),</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">attrs</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
    <span class="k">if</span> <span class="n">attrs</span><span class="p">:</span>
        <span class="n">open_tag</span> <span class="o">=</span> <span class="s">&#39;&lt;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nonclosing</span><span class="p">:</span>
        <span class="n">content</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">close_tag</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;</span><span class="si">%s%s%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">open_tag</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">close_tag</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">content</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s%s%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">open_tag</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">close_tag</span><span class="p">)</span>

</div>
<span class="n">SPAN</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="s">&#39;span&#39;</span><span class="p">)</span>
<span class="n">UL</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="s">&#39;ul&#39;</span><span class="p">)</span>
<span class="n">LI</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="s">&#39;li&#39;</span><span class="p">)</span>
<span class="n">P</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="s">&#39;p&#39;</span><span class="p">)</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">)</span>
<span class="n">INPUT</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="s">&#39;input&#39;</span><span class="p">,</span> <span class="n">nonclosing</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">BUTTON</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="s">&#39;button&#39;</span><span class="p">)</span>
<span class="n">SUBMIT</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">BUTTON</span><span class="p">,</span> <span class="n">_type</span><span class="o">=</span><span class="s">&#39;submit&#39;</span><span class="p">)</span>
<span class="n">HIDDEN</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">n</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">INPUT</span><span class="p">(</span><span class="n">_name</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">v</span><span class="p">,</span> <span class="n">_type</span><span class="o">=</span><span class="s">&#39;hidden&#39;</span><span class="p">)</span>
<span class="n">TEXTAREA</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="s">&#39;textarea&#39;</span><span class="p">)</span>
<span class="n">BUTTON</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="s">&#39;button&#39;</span><span class="p">)</span>
<span class="n">OPTION</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="s">&#39;option&#39;</span><span class="p">)</span>
<span class="n">SELECT</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="s">&#39;select&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="vinput"><a class="viewcode-back" href="../../html.html#bottle_utils.html.vinput">[docs]</a><span class="k">def</span> <span class="nf">vinput</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Render input with bound value. This function can be used to bind values to</span>
<span class="sd">    form inputs. By default it will result in HTML markup for a generic input.</span>
<span class="sd">    The generated input has a ``name`` attribute set to specified name, and</span>
<span class="sd">    an ``id`` attribute that has the same value.</span>
<span class="sd">    ::</span>
<span class="sd">        &gt;&gt;&gt; vinput(&#39;foo&#39;, {})</span>
<span class="sd">        &#39;&lt;input name=&quot;foo&quot; id=&quot;foo&quot;&gt;&#39;</span>

<span class="sd">    If the supplied dictionary of field values contains a key that matches the</span>
<span class="sd">    specified name (case-sensitive), the value of that key will be used as the</span>
<span class="sd">    value of the input::</span>

<span class="sd">        &gt;&gt;&gt; vinput(&#39;foo&#39;, {&#39;foo&#39;: &#39;bar&#39;})</span>
<span class="sd">        &#39;&lt;input name=&quot;foo&quot; id=&quot;foo&quot; value=&quot;bar&quot;&gt;&#39;</span>

<span class="sd">    All values are properly sanitized before they are added to the markup.</span>

<span class="sd">    Any additional keyword arguments that are passed to this function are</span>
<span class="sd">    passed on the the :py:func:`~bottle_utils.html.tag` function. Since the</span>
<span class="sd">    generated input markup is for generic text input, some of the other usual</span>
<span class="sd">    input types can be specified using ``_type`` parameter::</span>

<span class="sd">        &gt;&gt;&gt; input(&#39;foo&#39;, {}, _type=&#39;email&#39;)</span>
<span class="sd">        &#39;&lt;input name=&quot;foo&quot; id=&quot;foo&quot; type=&quot;email&quot;&gt;&#39;</span>

<span class="sd">    :param name:    field name</span>
<span class="sd">    :param values:  dictionary or dictionary-like object containing field</span>
<span class="sd">                    values</span>
<span class="sd">    :returns:       HTML markup for the field with bound value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">attrs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;_id&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">INPUT</span><span class="p">(</span><span class="n">_name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">INPUT</span><span class="p">(</span><span class="n">_name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="varea"><a class="viewcode-back" href="../../html.html#bottle_utils.html.varea">[docs]</a><span class="k">def</span> <span class="nf">varea</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Render textarea with bound value. Textareas use a somewhat different markup</span>
<span class="sd">    to that of regular inputs, so a separate function is used for binding</span>
<span class="sd">    values to this form control.::</span>

<span class="sd">        &gt;&gt;&gt; varea(&#39;foo&#39;, {&#39;foo&#39;: &#39;bar&#39;})</span>
<span class="sd">        &#39;&lt;textarea name=&quot;foo&quot; id=&quot;foo&quot;&gt;bar&lt;/textarea&gt;&#39;</span>

<span class="sd">    This function works the same way as :py:func:`~bottle_utils.html.vinput`</span>
<span class="sd">    function, so please look at it for more information. The primary difference</span>
<span class="sd">    is in the generated markup.</span>

<span class="sd">    :param name:    field name</span>
<span class="sd">    :param values:  dictionary or dictionary-like object containing field</span>
<span class="sd">                    values</span>
<span class="sd">    :returns:       HTML markup for the textarea with bound value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">attrs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;_id&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">TEXTAREA</span><span class="p">(</span><span class="n">_name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">TEXTAREA</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">_name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="vcheckbox"><a class="viewcode-back" href="../../html.html#bottle_utils.html.vcheckbox">[docs]</a><span class="k">def</span> <span class="nf">vcheckbox</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Render checkbox with bound value. This function renders a checkbox which is</span>
<span class="sd">    checked or unchecked depending on whether its own name-value combination</span>
<span class="sd">    appears in the provided form values dictionary.</span>

<span class="sd">    Because there are many ways to think about checkboxes in general, this</span>
<span class="sd">    particular function may or may not work for you. It treats checkboxes as a</span>
<span class="sd">    list of alues which are all named the same.</span>

<span class="sd">    Let&#39;s say we have markup that looks like this::</span>

<span class="sd">        &lt;input type=&quot;checkbox&quot; name=&quot;foo&quot; value=&quot;1&quot;&gt;</span>
<span class="sd">        &lt;input type=&quot;checkbox&quot; name=&quot;foo&quot; value=&quot;2&quot;&gt;</span>
<span class="sd">        &lt;input type=&quot;checkbox&quot; name=&quot;foo&quot; value=&quot;3&quot;&gt;</span>

<span class="sd">    If user checks all of them, we consider it a list ``foo=[&#39;1&#39;, &#39;2&#39;, &#39;3&#39;]``.</span>
<span class="sd">    If user checks only the first and last, we have ``foo=[&#39;1&#39;, &#39;3&#39;]``. And so</span>
<span class="sd">    on.</span>

<span class="sd">    This function assumes that you are using  this pattern.</span>

<span class="sd">    The ``values`` map can either map the checkbox name to a single value, or a</span>
<span class="sd">    list of multiple values. In the former case, if the single value matches</span>
<span class="sd">    the value of the checkbox, the checkbox is checked. In the latter case, if</span>
<span class="sd">    value of the checkbox is found in the list of values, the checkbox is</span>
<span class="sd">    checked.::</span>

<span class="sd">        &gt;&gt;&gt; vcheckbox(&#39;foo&#39;, &#39;bar&#39;, {&#39;foo&#39;: &#39;bar&#39;})</span>
<span class="sd">        &#39;&lt;input type=&quot;checkbox&quot; name=&quot;foo&quot; id=&quot;foo&quot; value=&quot;bar&quot; checked&gt;&#39;</span>
<span class="sd">        &gt;&gt;&gt; vcheckbox(&#39;foo&#39;, &#39;bar&#39;, {&#39;foo&#39;: [&#39;foo&#39;, &#39;bar&#39;, &#39;baz&#39;]})</span>
<span class="sd">        &#39;&lt;input type=&quot;checkbox&quot; name=&quot;foo&quot; id=&quot;foo&quot; value=&quot;bar&quot; checked&gt;&#39;</span>
<span class="sd">        &gt;&gt;&gt; vcheckbox(&#39;foo&#39;, &#39;bar&#39;, {&#39;foo&#39;: [&#39;foo&#39;, &#39;baz&#39;]})</span>
<span class="sd">        &#39;&lt;input type=&quot;checkbox&quot; name=&quot;foo&quot; id=&quot;foo&quot; value=&quot;bar&quot;&gt;&#39;</span>

<span class="sd">    When the field values dictionary doesn&#39;t contain a key that matches the</span>
<span class="sd">    checkbox name, the value of ``default`` keyword argument determines whether</span>
<span class="sd">    the checkbox should be checked::</span>

<span class="sd">        &gt;&gt;&gt; vcheckbox(&#39;foo&#39;, &#39;bar&#39;, {}, default=True)</span>
<span class="sd">        &#39;&lt;input type=&quot;checkbox&quot; name=&quot;foo&quot; id=&quot;foo&quot; value=&quot;bar&quot; checked&gt;&#39;</span>

<span class="sd">    :param name:    field name</span>
<span class="sd">    :param value:   value of the checkbox</span>
<span class="sd">    :param values:  dictionary or dictionary-like object containing field</span>
<span class="sd">    :param default: default state when input is not bound (``True`` for</span>
<span class="sd">                    checked)</span>
<span class="sd">    :returns:       HTML markup for the checkbox with bound value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">getall</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="n">values</span><span class="p">:</span>
                <span class="n">attrs</span><span class="p">[</span><span class="s">&#39;checked&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">elif</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="n">attrs</span><span class="p">[</span><span class="s">&#39;checked&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">elif</span> <span class="n">default</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">default</span><span class="p">:</span>
            <span class="n">attrs</span><span class="p">[</span><span class="s">&#39;checked&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">elif</span> <span class="s">&#39;checked&#39;</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">attrs</span><span class="p">[</span><span class="s">&#39;checked&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">INPUT</span><span class="p">(</span><span class="n">_type</span><span class="o">=</span><span class="s">&#39;checkbox&#39;</span><span class="p">,</span> <span class="n">_id</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">_name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="vselect"><a class="viewcode-back" href="../../html.html#bottle_utils.html.vselect">[docs]</a><span class="k">def</span> <span class="nf">vselect</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">choices</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">empty</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Render select list with bound value. This function renders the select list</span>
<span class="sd">    with option elements with appropriate element selected based on field</span>
<span class="sd">    values that are passed.</span>

<span class="sd">    The values and labels for option elemnets are specified using an iterable</span>
<span class="sd">    of two-tuples::</span>

<span class="sd">        &gt;&gt;&gt; vselect(&#39;foo&#39;, ((1, &#39;one&#39;), (2, &#39;two&#39;),), {})</span>
<span class="sd">        &#39;&lt;select name=&quot;foo&quot; id=&quot;foo&quot;&gt;&lt;option value=&quot;1&quot;&gt;one&lt;/option&gt;&lt;option...&#39;</span>

<span class="sd">    There is no mechanism for default value past what browsers support, so you</span>
<span class="sd">    should generally assume that most browsers will render the select with</span>
<span class="sd">    frist value preselected. Using an empty string or ``None`` as option value</span>
<span class="sd">    will render an option element without value::</span>

<span class="sd">        &gt;&gt;&gt; vselect(&#39;foo&#39;, ((None, &#39;---&#39;), (1, &#39;one&#39;),), {})</span>
<span class="sd">        &#39;&lt;select name=&quot;foo&quot; id=&quot;foo&quot;&gt;&lt;option value&gt;---&lt;/option&gt;&lt;option val...&#39;</span>
<span class="sd">        &gt;&gt;&gt; vselect(&#39;foo&#39;, ((&#39;&#39;, &#39;---&#39;), (1, &#39;one&#39;),), {})</span>
<span class="sd">        &#39;&lt;select name=&quot;foo&quot; id=&quot;foo&quot;&gt;&lt;option value=&quot;&quot;&gt;---&lt;/option&gt;&lt;option ...&#39;</span>

<span class="sd">    When specifying values, keep in mind that only ``None`` is special, in that</span>
<span class="sd">    it will crete a ``value`` attribute without any value. All other Python</span>
<span class="sd">    types become strings in the HTML markup, and are submitted as such. You</span>
<span class="sd">    will need to convert the values back to their appropriate Python type</span>
<span class="sd">    manually.</span>

<span class="sd">    If the choices iterable does not contain an element representing the empty</span>
<span class="sd">    value (``None``), you can specify it using the ``empty`` parameter. The</span>
<span class="sd">    argument for ``empty`` should be a label, and the matching value is</span>
<span class="sd">    ``None``. The emtpy value is always inseted at the beginning of the list.</span>

<span class="sd">    :param name:    field name</span>
<span class="sd">    :param choices: iterable of select list choices</span>
<span class="sd">    :param values:  dictionary or dictionary-like object containing field</span>
<span class="sd">    :param empty:   label for empty value</span>
<span class="sd">    :returns:       HTML markup for the select list with bound value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">options</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">val</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">choices</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="n">value</span><span class="p">:</span>
            <span class="n">options</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">OPTION</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">val</span><span class="p">,</span> <span class="n">selected</span><span class="o">=</span><span class="bp">None</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">options</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">OPTION</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">val</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">empty</span><span class="p">:</span>
        <span class="n">options</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">OPTION</span><span class="p">(</span><span class="n">empty</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">None</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">SELECT</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">options</span><span class="p">),</span> <span class="n">_id</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">_name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="link_other"><a class="viewcode-back" href="../../html.html#bottle_utils.html.link_other">[docs]</a><span class="k">def</span> <span class="nf">link_other</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">wrapper</span><span class="o">=</span><span class="k">lambda</span> <span class="n">l</span><span class="p">,</span> <span class="o">*</span><span class="n">kw</span><span class="p">:</span> <span class="n">l</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Only wrap label in anchor if given URL is not the path. Given a label, this</span>
<span class="sd">    function will match the page URL against the path to which the label should</span>
<span class="sd">    point, and generate the anchor element markup as necessary.</span>

<span class="sd">    Any additional keyword arguments are passed to the function that generates</span>
<span class="sd">    the anchor markup, which is ``A`` alias for</span>
<span class="sd">    :py:func:`~bottle_utils.html.tag` function.</span>

<span class="sd">    If the URLs match (meaning the page URL matches the target path), the label</span>
<span class="sd">    will be passed to the wrapper function. The default behavior of the wrapper</span>
<span class="sd">    function is to return the label as is. The label is thus returned as is if</span>
<span class="sd">    the URLs match.</span>
<span class="sd">    ::</span>
<span class="sd">        &gt;&gt;&gt; link_other(&#39;foo&#39;, &#39;/here&#39;, &#39;/there&#39;)</span>
<span class="sd">        &#39;&lt;a href=&quot;/target&quot;&gt;foo&lt;/a&gt;&#39;</span>
<span class="sd">        &gt;&gt;&gt; link_other(&#39;foo&#39;, &#39;/there&#39;, &#39;/there&#39;)</span>
<span class="sd">        &#39;foo&#39;</span>

<span class="sd">    You can customize the appearance of the label in the case URLs match by</span>
<span class="sd">    customizing the wrapper::</span>

<span class="sd">        &gt;&gt;&gt; link_other(&#39;foo&#39;, &#39;/there&#39;, &#39;/there&#39;,</span>
<span class="sd">        ...            wrapper=lambda l, **kw: l + &#39;bar&#39;)</span>
<span class="sd">        &#39;foobar&#39;</span>

<span class="sd">    Note that the wrapper lambda function has wild-card keyword arguments. The</span>
<span class="sd">    wrapper function accepts the same extra keyword arguments that the anchor</span>
<span class="sd">    function does, so if you have common classes and similar attributes, you</span>
<span class="sd">    can specify them as extra keyword arguments and use any of the helper</span>
<span class="sd">    functions in this module.::</span>

<span class="sd">        &gt;&gt;&gt; link_other(&#39;foo&#39;, &#39;/here&#39;, &#39;/there&#39;, wrapper=SPAN, _class=&#39;cls&#39;)</span>
<span class="sd">        &#39;&lt;a class=&quot;cls&quot; href=&quot;/target&quot;&gt;foo&lt;/a&gt;&#39;</span>
<span class="sd">        &gt;&gt;&gt; link_other(&#39;foo&#39;, &#39;/there&#39;, &#39;/there&#39;, wrapper=SPAN, _class=&#39;cls&#39;)</span>
<span class="sd">        &#39;&lt;span class=&quot;cls&quot;&gt;foo&lt;/span&gt;&#39;</span>

<span class="sd">    :param label:   label of the link</span>
<span class="sd">    :param url:     URL to which label should be linked</span>
<span class="sd">    :param path:    path to test URL against</span>
<span class="sd">    :param wrapper: function that should be used to wrap the label if URL</span>
<span class="sd">                    matches the path (i.e., anchor is not being rendered)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">url</span> <span class="o">==</span> <span class="n">path</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">wrapper</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">A</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">href</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="field_error"><a class="viewcode-back" href="../../html.html#bottle_utils.html.field_error">[docs]</a><span class="k">def</span> <span class="nf">field_error</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">errors</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Renders error message for single form field. This function renders a</span>
<span class="sd">    standardized markup for individual form field errors.</span>

<span class="sd">    .. note::</span>

<span class="sd">       This is not a generic helper function like the other ones. It&#39;s more of</span>
<span class="sd">       an opinion on how error messages should be rendered, and it has no</span>
<span class="sd">       particular rationale behind it rather than &#39;This is how I do things&#39;.</span>
<span class="sd">       The reason it is included here is that having consistent markup for form</span>
<span class="sd">       errors tends to increase the speed at which we are able to implement</span>
<span class="sd">       interfaces.</span>

<span class="sd">    For the error messages the render, the error dictionary must contain a key</span>
<span class="sd">    that matches the specified key. The key may map to a single string value or</span>
<span class="sd">    an iterable containing strings. Depending on how many error messages there</span>
<span class="sd">    are, one or more of span elements will be rendered. Every span will have</span>
<span class="sd">    &#39;field-error&#39; class.</span>

<span class="sd">    :param name:    name of the field to look up in the dict</span>
<span class="sd">    :param errors:  dict-like object containing field-name-message mappings</span>
<span class="sd">    :returns:       HTML of the error message if one is found, otherwise empty</span>
<span class="sd">                    string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">SPAN</span><span class="p">(</span><span class="n">html_escape</span><span class="p">(</span><span class="n">errors</span><span class="p">[</span><span class="n">name</span><span class="p">]),</span> <span class="n">_class</span><span class="o">=</span><span class="n">ERR_CLS</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span>

</div>
<div class="viewcode-block" id="form_errors"><a class="viewcode-back" href="../../html.html#bottle_utils.html.form_errors">[docs]</a><span class="k">def</span> <span class="nf">form_errors</span><span class="p">(</span><span class="n">errors</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Renders a form error. This function renders a standardized markup for form</span>
<span class="sd">    errors in your template.</span>

<span class="sd">    Please see notes for :py:func:`~bottle_utils.html.field_error` for the</span>
<span class="sd">    reasoning behind this helper function.</span>

<span class="sd">    Input dictionary must contain a special key &#39;_&#39; which is treated as key for</span>
<span class="sd">    form-wide errors that are not specific to any field. The value can either</span>
<span class="sd">    be a single string or an iterable of strings.</span>

<span class="sd">    Errors are always rendered as unordered list with each error message as</span>
<span class="sd">    list item, even when there is only one error. The list items always have</span>
<span class="sd">    the &#39;form-error&#39; class, and the unordered list has the &#39;form-errors&#39; class.</span>

<span class="sd">    For example::</span>

<span class="sd">        &gt;&gt;&gt; form_errors({&#39;_&#39;: &#39;Ouch!&#39;})</span>
<span class="sd">        &#39;&lt;ul class=&quot;form-errors&quot;&gt;&lt;li class=&quot;form-error&quot;&gt;Ouch!&lt;/li&gt;&lt;/ul&gt;&#39;</span>
<span class="sd">        &gt;&gt;&gt; form_errors({&#39;_&#39;: [&#39;Ouf!&#39;, &#39;Pain!&#39;]})</span>
<span class="sd">        &#39;&lt;ul class=&quot;form-errors&quot;&gt;&lt;li class=&quot;form-error&quot;&gt;Ouf!&lt;/li&gt;&lt;li clas...&#39;</span>

<span class="sd">    :param errors:  dictionary or dictionary-like object containing field</span>
<span class="sd">                    name-error mappings</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">UL</span><span class="p">(</span><span class="n">LI</span><span class="p">(</span><span class="n">html_escape</span><span class="p">(</span><span class="n">errors</span><span class="p">[</span><span class="s">&#39;_&#39;</span><span class="p">]),</span> <span class="n">_class</span><span class="o">=</span><span class="n">FERR_ONE_CLS</span><span class="p">),</span>
                  <span class="n">_class</span><span class="o">=</span><span class="n">FERR_CLS</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">P</span><span class="p">(</span><span class="n">SPAN</span><span class="p">(</span><span class="n">html_escape</span><span class="p">(</span><span class="n">errors</span><span class="p">[</span><span class="s">&#39;_&#39;</span><span class="p">]),</span> <span class="n">_class</span><span class="o">=</span><span class="n">FERR_ONE_CLS</span><span class="p">),</span>
                 <span class="n">_class</span><span class="o">=</span><span class="n">FERR_CLS</span><span class="p">)</span>

</div>
<span class="k">def</span> <span class="nf">add_qparam</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add query string parameter to current path in request context.</span>

<span class="sd">    This function will overwrite existing parameters. If an existing parameter</span>
<span class="sd">    has multiple values (e.g., ``?q=1&amp;q=2``) only the first one is overwritten,</span>
<span class="sd">    but the order in which the values are added to the params dictionary may</span>
<span class="sd">    not necessarily match the order in which they appear in the URL, so this</span>
<span class="sd">    should be avoided.</span>

<span class="sd">    The return value of this function is current request path with parameter</span>
<span class="sd">    appended.</span>

<span class="sd">    :param param:   parameter name</span>
<span class="sd">    :param value:   value for the parameter</span>
<span class="sd">    :returns:       path with query string parameter added</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
    <span class="n">params</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="n">path</span> <span class="o">+</span> <span class="s">&#39;?&#39;</span> <span class="o">+</span> <span class="s">&#39;&amp;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="p">[</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">quote</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf8&#39;</span><span class="p">)))</span>
         <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">allitems</span><span class="p">()]</span>
    <span class="p">)</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">Bottle Utils 0.1a1 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Outernet Inc &lt;hello@outernet.is&gt;.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>